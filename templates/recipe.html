{% extends "layout.html" %}

{% block title %}
    New recipe
{% endblock %}

{% block main %}
<button type="button" onclick="location.href='/'" class="fourth btn btn-lg aa">Cancel</button>

<form action="/recipe" method="post" style="text-align: left;">
    <div class="form-group">
        <p class="h2" style="margin-bottom:2%; margin-top:-5%">Recipe title</p>
        <textarea rows="1" cols="140" style="resize: none" class="form-control" id="title" name="title1" maxlength="94"></textarea>
    </div>


<div class="form-group" style="text-align: left;">
    <p class="h2" style="margin-top:2%">Ingredients</p>
</div>

<div class="form-group">   
<textarea rows="8" cols="140" class="form-control" id="ingredients1" name="ingredients1" maxlength="94"></textarea>
</div>


<script>
    // function add_row() {
    // $(table1).find('tbody').append('<tr><td id="ingredients" name="ingredients" style="text-align:center; vertical-align: middle;"><input value=""></input></td><td id="ingredients" name="ingredients" style="text-align:center; vertical-align: middle;"><input value=""></input></td></tr>');
    // }

    // function remove() {
    //     var aObj=document.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    //     var i=aObj.length;
    //     while(i>1){
    //         document.getElementById("table1").deleteRow(i);
    //     }
    // }


    function submit_message() {

        var recipe_title = document.getElementById("title").value;
        var preparation = document.getElementById("preparation").value;

        //iterate through rows
        //rows would be accessed using the "row" variable assigned in the for loop
        var arr = [];
        var table = document.getElementById("table1");
        for (var i = 1; row = table.rows[i]; i++) {
            arr.push({
                ingrediente: row.cells[1].innerText,
                quantity: row.cells[2].innerText
            })
        }
         
    var entry = {
        recipe_title: recipe_title,
        ingredients: arr,
        preparation: preparation
    }
    
    console.log(entry)

    $.ajax({
    type: 'POST',
    contentType: 'json/application',
    url: '/recipe',
    dataType : 'text',
    data : JSON.stringify(entry),
    success : function(result) {
      jQuery("#form").html(result); 
    },error : function(result){
       console.log(result);
    }
    });

    }

</script>

</table>            
    <p class="h2" style="text-align: left;">Preparation</p>

    <div class="form-group" style="text-align: left;">
        <textarea class="form-control" id="preparation" name="preparation" rows="13" cols="140"></textarea>
    </div>    

    <button type="submit" id="submit" class="btn second btn-lg" onclick="submit_message();">Submit</button>

</form>
{% endblock %}